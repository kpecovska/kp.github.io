<!DOCTYPE html>
<html>
  <head>

    <!-- GTM Datalayer init -->
    <script>
    window.dataLayer = window.dataLayer || [];
    </script>

    <!-- Google Tag Manager -->
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-WRKRQ3R');</script>
    <!-- End Google Tag Manager -->

    <title>People WebSDK page with Google Tag Manager</title>
	  
   <script>
	//this is for Web Push
     (function(I,n,f,o,b,i,p){
     I[b]=I[b]||function(){(I[b].q=I[b].q||[]).push(arguments)};
     I[b].t=1*new Date();i=n.createElement(f);i.async=1;i.src=o;
     p=n.getElementsByTagName(f)[0];p.parentNode.insertBefore(i,p)})
     (window,document,'script','https://webpush.infobip.com/bundle-latest.js','infobipWebPush');

     infobipWebPush('init', {
       applicationCode: 'e620ef195de6d62670c39d9ea6aa1a29-c5b6f553-5b93-4e4d-9162-f84bcf77fd66',
       vapidPublicKey: 'BBKAfE0JifGYsMyta5toQ48TaC9W4Snnh9TtkSKqE0-XSzlW2Px7D8qEXnA-OSEGIbcgWI3YQKClF9LAfEl2T9o=',
       optIn: {
         autostart: true,
       },
     });
   </script>	  

  </head>
  <body>

    <!-- Google Tag Manager (noscript) -->
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WRKRQ3R"
      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <h1>People WebSDK test site with Google Tag mngr.</h1>
    <hr>   

    <h2>Login form: By Email</h2>
    <form class="login-form">
       <div>
        <label for="email">Provide your email: </label>
        <input type="text" name="email" id="email" required>
      </div>
      <div>
        <input type="submit" value="Log In">
      </div>
    </form>

    <hr>
	  
    <h2>Login form: By Push Reg. Id </h2>
    <form class="login-form-push">
       <div>
        <label for="pushRegId">Provide your Push registration Id: </label>
        <input type="text" name="pushRegId" id="pushRegId" required>
      </div>
      <div>
        <input type="submit" value="Log In Push">
      </div>
    </form>

    <hr>

    <h2>Profile update form:</h2>
    <form class="profile-form">
      <div>
        <label for="firstName">Your first name: </label>
        <input type="text" name="firstName" id="firstName" required>
      </div>
      <div>
        <label for="lastName">Your Last name: </label>
        <input type="text" name="lastName" id="lastName" required>
      </div>
      <div>
        <input type="submit" value="Update Profile">
      </div>
    </form>

    <hr>

    <h2>Send event form (event = purchaseProduct):</h2>
     <form class="event-form">
       <div>
        <label for="product">Product Name: </label>
        <input type="text" name="product" id="product" required>
      </div>
       <div>
        <label for="product_qty">Quantity: </label>
        <input type="text" name="product_qty" id="product_qty" required>
      </div>
      <div>
        <input type="submit" value="Send Event">
      </div>
    </form>
	  
    <hr>

    <h2>Forget person</h2>
     <form class="forget-form">
	<div>
         <input type="submit" value="Forget Session">
        </div>
    </form>

    <hr>
	  
    <h2>Navigation</h2>	 
	  
    <button  class="button-register" onclick="goToTemplateEvents()" type="button">
       Go to Template Events test page
    </button>
	  
     <script>
	     
      (function(I,n,f,o,b,i,p){
         I[b]=I[b]||function(){(I[b].q=I[b].q||[]).push(arguments)};
         I[b].t=1*new Date();i=n.createElement(f);i.async=1;i.src=o;
          p=n.getElementsByTagName(f)[0];p.parentNode.insertBefore(i,p)})
      (window,document,'script','https://webpush.infobip.com/bundle-latest.js','infobipWebPush');
	     
	infobipWebPush('on', 'permissionChanged', function (perimssion) {
	    if (permission === 'default') {
		console.log('default');
	    } else if (permission === 'granted') {
		console.log('granted');
	    } else if (permission === 'denied') {
		console.log('denied');
	    }
	});
	     
	     
	     
      const onLoginFormSubmit = (evt) => {
        evt.preventDefault();
        const formData = new FormData(document.querySelector('.login-form'));
        const formEmail = formData.get('email');
        window.dataLayer.push({'person_email': formEmail, 'event': 'login'});
        console.log('Logged In');
      };

      const onLoginFormPushSubmit = (evt) => {
        evt.preventDefault();
        const formDataPush = new FormData(document.querySelector('.login-form-push'));
        const formPushRegId = formDataPush.get('pushRegId');
        window.dataLayer.push({'person_pushRegId': formPushRegId, 'event': 'loginPushRegId'});
        console.log('Logged In with Push Reg. Id');
      };
	     
      const onSendClick = (evt) => {
        evt.preventDefault();
        const formData = new FormData(document.querySelector('.event-form'));
        const formProduct = formData.get('product');
        const formProductQty = formData.get('product_qty');
        window.dataLayer.push({'product_name': formProduct, 'product_qty': formProductQty, 'event': 'purchase'});
        console.log('Product Purchased');
		     };

       const onUpdateClick = (evt) => {
        evt.preventDefault();
        const formData = new FormData(document.querySelector('.profile-form'));
        const formFirst = formData.get('firstName');
        const formLast = formData.get('lastName');
        window.dataLayer.push({'first_name': formFirst, 'last_name': formLast, 'event': 'update_profile'});
        console.log('Updated Profile');
		      };
	     
	const onForgetClick = (evt) => {
		     };

    const loginForm = document.querySelector('.login-form');
      loginForm.addEventListener('submit', onLoginFormSubmit);
    const loginFormPush = document.querySelector('.login-form-push');
      loginFormPush.addEventListener('submit', onLoginFormPushSubmit);
    const profileForm = document.querySelector('.profile-form');
      profileForm.addEventListener('submit', onUpdateClick);
    const eventForm = document.querySelector('.event-form');
      eventForm.addEventListener('submit', onSendClick);
	const forgetForm = document.querySelector('.forget-form');
      eventForm.addEventListener('submit', onForgetClick);
	     
	function goToTemplateEvents() {
        window.location = './template_events.html';
      }
	     
    </script>

  </body>
</html>
